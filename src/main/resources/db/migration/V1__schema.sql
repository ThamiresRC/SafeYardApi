CREATE CACHED TABLE CLIENTE (
  ID    BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL,
  CPF   VARCHAR(11)  NOT NULL,
  EMAIL VARCHAR(100) NOT NULL,
  NOME  VARCHAR(100) NOT NULL
);
ALTER TABLE CLIENTE ADD CONSTRAINT PK_CLIENTE PRIMARY KEY (ID);
ALTER TABLE CLIENTE ADD CONSTRAINT UK_CLIENTE_CPF UNIQUE (CPF);

CREATE CACHED TABLE MOTO (
  ID          BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL,
  CHASSI      VARCHAR(17)  NOT NULL,
  IMAGEM_PATH VARCHAR(255),
  MODELO      VARCHAR(30)  NOT NULL,
  PLACA       VARCHAR(7)   NOT NULL,
  STATUS      VARCHAR(30)  NOT NULL
);
ALTER TABLE MOTO ADD CONSTRAINT PK_MOTO PRIMARY KEY (ID);
ALTER TABLE MOTO ADD CONSTRAINT UK_MOTO_PLACA UNIQUE (PLACA);

CREATE CACHED TABLE REGISTRO_MOTO_PATIO (
  ID                 BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL,
  DATA_HORA_REGISTRO TIMESTAMP(6) NOT NULL,
  SETOR              VARCHAR(30)  NOT NULL,
  TIPO               VARCHAR(10)  NOT NULL,
  VAGA               VARCHAR(3)   NOT NULL,
  MOTO_ID            BIGINT
);
ALTER TABLE REGISTRO_MOTO_PATIO ADD CONSTRAINT PK_REGISTRO PRIMARY KEY (ID);

CREATE CACHED TABLE LOCACAO (
  ID                 BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL,
  CONDICAO_DEVOLUCAO VARCHAR(30),
  CONDICAO_ENTREGA   VARCHAR(30),
  DATA_DEVOLUCAO     TIMESTAMP(6),
  DATA_SAIDA         TIMESTAMP(6) NOT NULL,
  QR_CODE            VARCHAR(200),
  CLIENTE_ID         BIGINT,
  MOTO_ID            BIGINT
);
ALTER TABLE LOCACAO ADD CONSTRAINT PK_LOCACAO PRIMARY KEY (ID);

CREATE CACHED TABLE USERS (
  ID    BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL,
  ATIVO BOOLEAN      NOT NULL,
  EMAIL VARCHAR(180) NOT NULL,
  NOME  VARCHAR(120) NOT NULL,
  ROLE  ENUM('ADMIN','CLIENTE','FUNCIONARIO') NOT NULL,
  SENHA VARCHAR(120) NOT NULL
);
ALTER TABLE USERS ADD CONSTRAINT PK_USERS PRIMARY KEY (ID);
ALTER TABLE USERS ADD CONSTRAINT UK_USERS_EMAIL UNIQUE (EMAIL);

CREATE CACHED TABLE TOKEN (
  ID       BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL,
  ATIVO    BOOLEAN,
  EXPIRADO BOOLEAN,
  TOKEN    VARCHAR(255),
  USER_ID  BIGINT
);
ALTER TABLE TOKEN ADD CONSTRAINT PK_TOKEN PRIMARY KEY (ID);

-- FKs
ALTER TABLE REGISTRO_MOTO_PATIO
    ADD CONSTRAINT FK_REGISTRO_MOTO FOREIGN KEY (MOTO_ID)  REFERENCES MOTO(ID);

ALTER TABLE LOCACAO
    ADD CONSTRAINT FK_LOCACAO_MOTO    FOREIGN KEY (MOTO_ID)    REFERENCES MOTO(ID);
ALTER TABLE LOCACAO
    ADD CONSTRAINT FK_LOCACAO_CLIENTE FOREIGN KEY (CLIENTE_ID) REFERENCES CLIENTE(ID);

ALTER TABLE TOKEN
    ADD CONSTRAINT FK_TOKEN_USER FOREIGN KEY (USER_ID) REFERENCES USERS(ID);
