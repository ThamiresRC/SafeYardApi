<!DOCTYPE html>
<html lang="pt-br"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="https://www.thymeleaf.org/extras/spring-security">

<head th:replace="~{fragments/_head :: head('Dashboard • SafeYard')}">
    <!-- fallback dev -->
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>Dashboard • SafeYard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
          rel="stylesheet" crossorigin="anonymous"/>
</head>

<body class="bg-light">

<!-- Navbar com parâmetro nomeado -->
<nav th:replace="~{fragments/_navbar :: navbar(active='dashboard')}"></nav>

<main class="container py-4"
      th:with="displayName=${#authentication?.principal?.nome != null ? #authentication.principal.nome
                            : (#authentication?.name != null ? #authentication.name : 'Usuário')}">

    <h1 class="h4 mb-3">
        Bem-vindo(a), <span th:text="${displayName}">Usuário</span>!
    </h1>

    <div class="alert alert-success" role="alert">
        Você autenticou com sucesso. Esta é uma página protegida.
    </div>

    <div class="row g-3">
        <!-- ====== Cards (ADMIN/FUNCIONARIO) ====== -->
        <div class="col-md-4" sec:authorize="hasAnyRole('ADMIN','FUNCIONARIO')">
            <div class="card shadow-sm h-100">
                <div class="card-body">
                    <h2 class="h6 d-flex align-items-center justify-content-between">
                        Clientes
                        <span class="badge bg-secondary" th:text="${totalClientes} ?: 0">0</span>
                    </h2>
                    <p class="text-muted mb-3">Resumo rápido de clientes.</p>
                    <a class="btn btn-sm btn-primary" th:href="@{/clientes}">Ver clientes</a>
                </div>
            </div>
        </div>

        <div class="col-md-4" sec:authorize="hasAnyRole('ADMIN','FUNCIONARIO')">
            <div class="card shadow-sm h-100">
                <div class="card-body">
                    <h2 class="h6 d-flex align-items-center justify-content-between">
                        Motos
                        <span class="badge bg-secondary" th:text="${totalMotos} ?: 0">0</span>
                    </h2>
                    <p class="text-muted mb-3">Status da frota e disponibilidade.</p>
                    <a class="btn btn-sm btn-primary" th:href="@{/motos}">Ver motos</a>
                </div>
            </div>
        </div>

        <div class="col-md-4" sec:authorize="hasRole('ADMIN')">
            <div class="card shadow-sm h-100">
                <div class="card-body">
                    <h2 class="h6">Relatórios</h2>
                    <p class="text-muted mb-3">Indicadores e métricas.</p>
                    <a class="btn btn-sm btn-primary" th:href="@{/relatorios}">Abrir relatórios</a>
                </div>
            </div>
        </div>

        <!-- ====== Minha área (CLIENTE) ====== -->
        <div class="col-md-4" sec:authorize="hasRole('CLIENTE')">
            <div class="card shadow-sm h-100">
                <div class="card-body">
                    <h2 class="h6">Minha área</h2>
                    <p class="text-muted mb-3">Acompanhe suas locações e solicite novas.</p>
                    <a class="btn btn-sm btn-outline-primary" th:href="@{/cliente/area}">Abrir</a>
                </div>
            </div>
        </div>

        <!-- ====== Locações (visível APENAS p/ ADMIN/FUNCIONARIO) ====== -->
        <div class="col-md-4" sec:authorize="hasAnyRole('ADMIN','FUNCIONARIO')">
            <div class="card shadow-sm h-100">
                <div class="card-body">
                    <h2 class="h6 d-flex align-items-center justify-content-between">
                        Locações
                        <span class="badge bg-secondary" th:text="${totalLocacoes} ?: 0">0</span>
                    </h2>
                    <p class="text-muted mb-3">Listagem, filtros e detalhes de locações.</p>
                    <a class="btn btn-sm btn-primary" th:href="@{/locacoes}">Ver locações</a>
                </div>
            </div>
        </div>
    </div>
</main>

<footer th:insert="~{fragments/_footer :: footer}"></footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        crossorigin="anonymous"></script>
<script src="/js/csrf.js"></script>
</body>
</html>
