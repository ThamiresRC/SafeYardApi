<!DOCTYPE html>
<html lang="pt-br"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="https://www.thymeleaf.org/extras/spring-security">
<head th:replace="~{fragments/_head :: head('Upload de foto • SafeYard')}"></head>
<body class="bg-light">

<nav th:replace="~{fragments/_navbar :: navbar(active='motos')}"></nav>

<main class="container py-4" style="max-width: 720px;">
    <h1 class="h4 mb-2">
        Upload de foto — <span th:text="${moto.placa}">PLACA</span>
    </h1>
    <p class="text-muted mb-4">
        Modelo: <span th:text="${moto.modelo}">Modelo</span>
    </p>

    <div th:if="${msg}" class="alert alert-success" th:text="${msg}"></div>
    <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>

    <div th:if="${moto.fotoUrl}" class="mb-3">
        <label class="form-label d-block">Foto atual</label>
        <img th:src="${moto.fotoUrl}" alt="Foto atual" style="max-height:120px;border-radius:8px">
    </div>

    <form th:action="@{'/motos/' + ${moto.id} + '/upload'}"
          method="post"
          enctype="multipart/form-data"
          class="card shadow-sm">
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

        <div class="card-body">
            <div class="mb-3">
                <label class="form-label">Selecione a imagem (JPG/PNG até 3MB)</label>
                <input id="fileInput" class="form-control" type="file" name="file" accept="image/*" required>
                <div class="form-text">
                    A imagem ficará disponível publicamente em <code>/files/...</code>.
                </div>
            </div>
        </div>

        <div class="card-footer d-flex justify-content-between">
            <a class="btn btn-outline-secondary" th:href="@{/motos}">Voltar</a>
            <button class="btn btn-primary" type="submit">Enviar</button>
        </div>
    </form>
</main>

<footer th:insert="~{fragments/_footer :: footer}"></footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>


<script>
    (function () {
        const input = document.getElementById('fileInput');
        if (!input) return;
        input.addEventListener('change', function () {
            const f = this.files && this.files[0];
            if (!f) return;
            const max = 3 * 1024 * 1024; // 3MB
            if (f.size > max) {
                alert('Arquivo maior que 3MB. Escolha uma imagem menor.');
                this.value = '';
            }
        });
    })();
</script>
</body>
</html>
