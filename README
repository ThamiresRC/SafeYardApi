<!-- PROJECT HEADER -->
<p align="center">
  <img src="https://img.shields.io/badge/Java-21-blue" alt="Java 21">
  <img src="https://img.shields.io/badge/Spring%20Boot-3.x-brightgreen" alt="Spring Boot 3">
  <img src="https://img.shields.io/badge/Build-Maven-orange" alt="Maven">
  <img src="https://img.shields.io/badge/DB-H2%20%7C%20Flyway-informational" alt="H2/Flyway">
  <img src="https://img.shields.io/badge/Auth-JWT-important" alt="JWT">
</p>

<h1 align="center">SafeYardApi</h1>
<p align="center">Backend Java (Spring Boot) para gestÃ£o de <b>pÃ¡tios de motos</b> com autenticaÃ§Ã£o JWT, migraÃ§Ãµes Flyway, documentaÃ§Ã£o Swagger e interface web com Thymeleaf.</p>

<p align="center">
  <a href="#-objetivo-do-projeto">Objetivo</a> â€¢
  <a href="#-stack">Stack</a> â€¢
  <a href="#-estrutura-de-pacotes">Estrutura</a> â€¢
  <a href="#-como-executar-modo-dev">Executar</a> â€¢
  <a href="#-documentaÃ§Ã£o-da-api">API</a> â€¢
  <a href="#-exemplos-curl">Curl</a> â€¢
  <a href="#-docker-opcional">Docker</a> â€¢
  <a href="#-desenvolvedores">Devs</a>
</p>

---

## ğŸ¯ Objetivo do Projeto
O **SafeYard** Ã© uma aplicaÃ§Ã£o Java (Spring Boot) inspirada no cenÃ¡rio da **Mottu**, criada para **modernizar e otimizar a gestÃ£o de pÃ¡tios de motos**. A soluÃ§Ã£o oferece:

- **API REST segura (JWT)** para **motos, clientes, locaÃ§Ãµes e registros**;
- **Interface web (Thymeleaf)** para **Administradores** (gestÃ£o da frota/locaÃ§Ãµes) e **Clientes** (minhas locaÃ§Ãµes);
- **Regras de negÃ³cio** que **evitam erros manuais** (sem dupla locaÃ§Ã£o, apenas motos `DISPONIVEL`, encerramento atualiza status);
- **Rastreabilidade** com **Flyway** (migrations/seeds) e **H2 Console** para inspeÃ§Ã£o.

> **Resultados esperados:** mais controle operacional, menos inconsistÃªncias e **experiÃªncia simples**: *login â†’ locaÃ§Ã£o â†’ encerramento â†’ relatÃ³rios*.

**Metas demonstrÃ¡veis na banca:**
1) Criar locaÃ§Ã£o **sem conflitos**; 2) **Encerrar** locaÃ§Ã£o atualizando a moto; 3) Cliente vÃª **histÃ³rico** e Admin a **frota**; 4) **Swagger + Authorize (JWT)** funcionando.

---

## ğŸ”§ Stack
- Java **21** Â· Spring Boot **3.x** (Web, Validation, JPA/Hibernate, Security)
- Auth: **JWT** (`com.auth0:java-jwt`)
- Banco: **H2** (dev) Â· opcional Postgres/MySQL (prod)
- MigraÃ§Ãµes: **Flyway** (`src/main/resources/db/migration`)
- Views: **Thymeleaf** (layouts + pÃ¡ginas)
- Docs: **springdoc-openapi** (`/swagger-ui.html`)
- Build: **Maven** Â· DevOps: Dockerfile + script

---

## ğŸ—‚ï¸ DomÃ­nio (resumo)
- **Cliente** â€“ dados cadastrais (pode possuir motos)
- **Moto** â€“ placa, modelo, chassi, fotoUrl, status: `DISPONIVEL` Â· `LOCADA` Â· `MANUTENCAO`
- **Locacao** â€“ check-in/check-out da moto (datas, condiÃ§Ãµes, cliente, moto)
- **RegistroMotoPatio** â€“ histÃ³rico de movimentaÃ§Ãµes (relatÃ³rios)
- **User / UserRole / Token** â€“ autenticaÃ§Ã£o/autorizaÃ§Ã£o

---

## ğŸ“ Estrutura de pacotes
```
src/main/java/com/safeyard/safeyard_api/
 â”œâ”€ config/        # CORS, Security, Swagger, Web + seed e init de storage
 â”œâ”€ controller/    # REST + Web (Thymeleaf) â€“ Auth, Cliente, Moto, Locacao, Registro
 â”œâ”€ dto/           # DTOs (Form, View e Responses de Auth)
 â”œâ”€ exception/     # Handler global e payload de erro
 â”œâ”€ model/         # Entidades JPA + enums
 â”œâ”€ repository/    # Spring Data JPA
 â”œâ”€ service/       # Regras + fachadas (Locacao) + Auth/JWT
 â””â”€ SafeyardApiApplication.java
```
> MigraÃ§Ãµes ficam em `resources/db.migration` (schema/Ã­ndices/seeds/regras).

---

## â–¶ï¸ Como Executar (modo DEV)
1. **PrÃ©-requisitos**: JDK **21**, Maven, porta **8080** livre.
2. **Clonar**: `git clone <repo>` e `cd SafeYardApi`
3. **Rodar**: `./mvnw spring-boot:run` (Linux/Mac) Â· `mvnw spring-boot:run` (Windows)
4. **Acesso rÃ¡pido**:
   - Web (Thymeleaf): `http://localhost:8080/login`
   - Swagger: `http://localhost:8080/swagger-ui.html`
   - H2 Console: `http://localhost:8080/h2-console` (JDBC: `jdbc:h2:file:./data/safeyard`)

> **Dev profile** jÃ¡ preparado: primeira execuÃ§Ã£o roda **Flyway** e cria schema + seeds.

---

## ğŸ” Contas de Teste (seed)
- **Cliente**: `cliente@safeyard.com` Â· **123456**
- **Admin**: `admin@safeyard.com` Â· **123456**
- **FuncionÃ¡rio**: `func@safeyard.com` Â· **123456**

> Ao logar, o **Dashboard** muda conforme o papel (cliente/admin).

---

## ğŸ“˜ DocumentaÃ§Ã£o da API
- **Swagger/OpenAPI**: `http://localhost:8080/swagger-ui.html`
- **SeguranÃ§a**: **Bearer JWT** â€“ faÃ§a login, copie o token e clique em **Authorize** no Swagger.

### Endpoints (principais)
**Auth**
`POST /api/auth/login` â†’ `{ token, name, role }` Â· `POST /api/auth/register` *(demo)*

**Motos** *(ADMIN/FUNC Â· leitura CLIENTE)*
`GET /api/motos?page=&size=&sort=` Â· `GET /api/motos/{id}` Â· `POST /api/motos` Â· `PUT/DELETE /api/motos/{id}`

**LocaÃ§Ãµes** *(CLIENTE/ADMIN)*
`GET /api/locacoes` Â· `GET /api/locacoes/{id}` Â· `POST /api/locacoes` Â· `PUT /api/locacoes/{id}/encerrar`

**Clientes / Registros**
`GET /api/clientes...` Â· `GET /api/registros`

---

## ğŸ§ª Exemplos (curl)
**Login**
```bash
curl -X POST http://localhost:8080/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"cliente@safeyard.com","password":"123456"}'
```
**Listar motos (com Bearer)**
```bash
TOKEN=ey... # copie do login
curl -H "Authorization: Bearer $TOKEN" http://localhost:8080/api/motos
```
**Criar locaÃ§Ã£o**
```bash
curl -X POST http://localhost:8080/api/locacoes \
  -H "Authorization: Bearer $TOKEN" -H "Content-Type: application/json" \
  -d '{
    "motoId": 1,
    "clienteId": 1,
    "condicaoEntrega": "tanque cheio, sem avarias",
    "devolucaoPrevista": "2025-10-05T18:00:00"
  }'
```

---

## ğŸ³ Docker (opcional)
**Dockerfile (resumo)**
```dockerfile
FROM eclipse-temurin:21-jdk
WORKDIR /app
COPY . .
RUN sed -i 's/\r$//' mvnw && chmod +x mvnw
RUN ./mvnw -B -DskipTests clean package
EXPOSE 8080
CMD ["sh","-c","java -Dserver.port=${PORT:-8080} -Dspring.profiles.active=${SPRING_PROFILES_ACTIVE:-dev} -jar target/safeyard-api-*.jar"]
```
**Build & run**
```bash
docker build -t safeyard-api .
docker run --rm -p 8080:8080 --name safeyard safeyard-api
```

---

## ğŸ” Troubleshooting
- **H2 Console nÃ£o abre** â†’ confira `spring.h2.console.enabled=true` e a URL JDBC acima.
- **JWT 401** â†’ faÃ§a login novamente e cole **apenas** o token no Authorize.
- **Flyway falhou** â†’ apague a pasta `data/` (somente em dev) e rode novamente.
- **Porta 8080 ocupada** â†’ use `server.port=8081` em `application-dev.properties`.

---

## ğŸ‘¨â€ğŸ’» Desenvolvedores
- **Thamires Ribeiro Cruz** â€” RM558128 Â· <a href="https://github.com/ThamiresRC">github.com/ThamiresRC</a>
- **Adonay Rodrigues da Rocha** â€” RM558782 Â· <a href="https://github.com/AdonayRocha">github.com/AdonayRocha</a>
- **Pedro Henrique Martins dos Reis** â€” RM555306 Â· <a href="https://github.com/pxxmdr">github.com/pxxmdr</a>

---

## ğŸ“œ LicenÃ§a
Uso acadÃªmico/educacional.
